<!DOCTYPE html><html><head><meta content="width=device-width" name=viewport><link href=/bundle.css rel=stylesheet><script src=/bundle.js defer></script><script src=/check.js async></script><link href=/favicon.ico rel="shortcut icon"><link href=/favicon.svg rel=icon><title>注册表修改文件关联(默认程序) - kkocdko's blog</title><meta content="在NT6+上通用" name=description><meta content=rgb(63,81,181) name=theme-color></head><body><main><article class=card><h1 id=注册表修改文件关联默认程序>注册表修改文件关联(默认程序)</h1><h3 id=introduction>Introduction</h3><p>由于各种原因（主要是安全方面考虑），Windows中修改文件关联的Api一改再改，改了又改。</p><p>而直接修改注册表+刷新Explorer的方法，也许是比较方便的能兼容各个Windows版本（NT6+）的方案（也许需要管理员权限）。</p><h3 id=code>Code</h3><pre><code>[-HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}]

[HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}]

[HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}\DefaultIcon]
@=&quot;{{IconFile}},{{IconIndex}}&quot;

[HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}\shell]

[HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}\shell\open]

[HKEY_CURRENT_USER\Software\Classes\{{AppName}}.{{Extension}}\shell\open\command]
@=&quot;\&quot;{{AppPath}}\&quot; \&quot;%1\&quot;&quot;

[HKEY_CURRENT_USER\Software\Classes\.{{Extension}}]
@=&quot;{{AppName}}.{{Extension}}&quot;

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.{{Extension}}]
&quot;Progid&quot;=&quot;{{AppName}}.{{Extension}}&quot;

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.{{Extension}}\OpenWithProgids]
&quot;{{AppName}}.{{Extension}}&quot;=hex(0):

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.{{Extension}}\UserChoice]
&quot;Progid&quot;=&quot;{{AppName}}.{{Extension}}&quot;</code></pre><p>示例：用Nodejs生成注册表文件</p><pre><code class=language-javascript>let fs = require(&#39;fs&#39;);

let templetStr = fs.readFileSync(`${__dirname}/templet.reg`).toString();
let extensionArr = &#39;avi wmv wmp wm asf mpg mpeg mpe m1v m2v&#39;.split(&#39; &#39;);
let appName = &#39;PotPlayerMini&#39;
let appPath = &#39;C:\\\\Program Files\\\\PotPlayer\\\\PotPlayerMini.exe&#39; // Need 4 &#39;\\&#39;
let outputText = &#39;&#39;;
for (let extension of extensionArr) {
    outputText += generateReg(appPath, appName, extension, appPath, &#39;0&#39;);
}
fs.writeFileSync(`${__dirname}/output_${Date.now()}.reg`, outputText);

function generateReg(appPath, appName, extension, iconFile, iconIndex) {
    let outputStr = templetStr;
    outputStr = outputStr.replace(/{{AppPath}}/g, appPath);
    outputStr = outputStr.replace(/{{AppName}}/g, appName);
    outputStr = outputStr.replace(/{{Extension}}/g, extension);
    outputStr = outputStr.replace(/{{IconFile}}/g, iconFile);
    outputStr = outputStr.replace(/{{IconIndex}}/g, iconIndex);
    return outputStr;
}</code></pre></article></main><header class=in id=extra></header></body></html>