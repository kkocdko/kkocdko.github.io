<!DOCTYPE html><meta content="width=device-width" name=viewport><meta content="可用于直播录制等" name=description><link href=/bundle.css rel=stylesheet><link href=/favicon.ico rel="shortcut icon"><link href=/favicon.svg rel=icon><script src=/bundle.js defer></script><script src=/check.js async></script><title>获取Bilibili直播流 - kkocdko's blog</title><main><article class=card><h1 id=获取bilibili直播流>获取Bilibili直播流</h1><h3 id=introduction>Introduction</h3><p>说到获取直播流，就不得不提到浏览器自带的开发者工具。啥都能看到，文体两开花，弘扬……</p><p>但是这总有些麻烦，另外，如果使用低性能平台，在bilibili直播这样的大型页面打开开发者工具，真的会影响心情。</p><p>更优雅的方式应该是——</p><h3 id=code>Code</h3><pre><code class=language-javascript>/**
 * Get Bilibili live play url
 * @param {number}   roomId      Room&#39;s id, short or long
 * @param {number}   lineNumber  Server line [ 0(main) | 1 ~ 3(bak) ]
 * @param {number}   quality     Video&#39;s quality [ 1(lowest) ~ 4(highest) ]
 * @param {string}   platform    Type of url [ h5(m3u8) | web(flv) ]
 */
async function getBiliLiveUrl(
    roomId = 3,
    lineNumber = 0,
    quality = 4,
    platform = &#39;web&#39;
) {
    let https = require(&#39;https&#39;);
    let readline = require(&#39;readline&#39;);

    let biliApi = {
        roomInit: &#39;api.live.bilibili.com/room/v1/Room/room_init&#39;,
        playUrl: &#39;api.live.bilibili.com/room/v1/Room/playUrl&#39;
    };
    let roomInfo = await fetchJsonAsync(
        biliApi.roomInit
        + `?id=${roomId}`
    );
    if (roomInfo.data.live_status == &#39;1&#39;) {
        let playInfo = await fetchJsonAsync(
            biliApi.playUrl
            + `?cid=${roomInfo.data.room_id}`
            + `&amp;quality=${quality}`
            + `&amp;platform=${platform}`
        );
        return playInfo.data.durl[lineNumber].url;
    } else {
        return null;
    }

    async function fetchJsonAsync(url) {
        return new Promise(resolve =&gt; {
            https.get(&#39;https://&#39; + url, res =&gt; {
                let rawData = &#39;&#39;;
                res.on(&#39;data&#39;, chunk =&gt; rawData += chunk);
                res.on(&#39;end&#39;, () =&gt; resolve(JSON.parse(rawData)));
            });
        });
    }
}</code></pre></article></main><header class=in></header>