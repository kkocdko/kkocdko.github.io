<!DOCTYPE html><meta content="width=device-width" name=viewport><link href=/bundle.css rel=stylesheet><script src=/bundle.js defer></script><script src=/check.js async></script><link href=/favicon.ico rel="shortcut icon"><link href=/favicon.svg rel=icon><title>随手整个NodeJS文件服务器 - kkocdko's blog</title><meta content="局域网里边传文件用，方便" name=description><main><article class=card><h1 id=随手整个nodejs文件服务器>随手整个NodeJS文件服务器</h1><h3 id=code>Code</h3><pre><code class=language-javascript>&#39;use strict&#39;;

const url = require(&#39;url&#39;);
const fs = require(&#39;fs&#39;);
const http = require(&#39;http&#39;);
const querystring = require(&#39;querystring&#39;);
const os = require(&#39;os&#39;);

const shareFolder = __dirname + &#39;/Share/&#39;;

let server = http.createServer((req, res) =&gt; {
    let requestPath = url.parse(req.url).path;
    requestPath = querystring.unescape(requestPath);
    let filePath = shareFolder + requestPath;
    fs.stat(filePath, (e, stats) =&gt; {
        if(e) {
            res.writeHead(404, {
                &#39;Content-Type&#39;: &#39;text/plain&#39;
            });
            res.end(&#39;404 not found&#39;);
        } else {
            if (stats.isFile()) {
                let file = fs.createReadStream(filePath);
                res.writeHead(200, {
                    &#39;Content-Type&#39;: &#39;application/octet-stream&#39;
                });
                file.pipe(res);
            } else {
                fs.readdir(filePath, (e, files) =&gt; {
                    let htmlContent = &#39;&#39;;
                    htmlContent += &#39;&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,user-scalable=no&quot;&gt;&#39;;
                    htmlContent += &#39;&lt;style&gt;html{background-color:#f8f9fa}body{box-sizing:border-box;margin:5vh auto;padding:20px;width:90vw;height:90vh;max-width:600px;border-radius:4px;background-color:#fff;box-shadow:rgba(0,0,0,.14) 0 2px 2px 0,rgba(0,0,0,.12) 0 1px 5px 0,rgba(0,0,0,.2) 0 3px 1px -2px}a:hover{background-color:rgba(0,0,0,.05)}a{display:block;color:#1a73e8;text-decoration:none;line-height:1.9em}&lt;/style&gt;&#39;;
                    htmlContent += `&lt;h1&gt;${requestPath}&lt;/h1&gt;&lt;hr&gt;`;
                    if (requestPath == &#39;/&#39;) {
                        requestPath = &#39;&#39;;
                    }
                    for (let file of files) {
                        let relativelyFilePath = requestPath + &#39;/&#39; + file;
                        let localFile = shareFolder + relativelyFilePath;
                        if (fs.statSync(localFile).isFile()) {
                            htmlContent += `&lt;a download href=&quot;${relativelyFilePath}&quot;&gt;${file}&lt;/a&gt;`;
                        } else {
                            htmlContent += `&lt;a href=&quot;${relativelyFilePath}&quot;&gt;${file}/&lt;/a&gt;`;
                        }
                    }
                    res.writeHead(200, {
                        &#39;Content-Type&#39;: &#39;text/html&#39;
                    });
                    res.end(htmlContent);
                });
            }
        }
    });
});

function getIpv4() {
    let interfaces = os.networkInterfaces();
    for (let key of Object.keys(interfaces)) {
        for (let item of interfaces[key]) {
            if (&#39;IPv4&#39; == item.family &amp;&amp; item.internal == false) {
                return item.address;
            }
        }
    }
    return null
}

let ip = getIpv4();
let port = 8888;
server.listen(port, ip);
console.log(&#39;Server is running on [&#39; + ip + &#39;:&#39; + port + &#39;]&#39;);</code></pre></article></main><header class=in id=extra></header>